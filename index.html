<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Resonance RPG -Ultra Slim-</title>
    <style>
        :root { --bg: #0a0a0c; --panel: #1a1a20; --owen: #9b59b6; --cain: #f1c40f; --hp: #e74c3c; --text: #dcdde1; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg); color: var(--text); font-family: sans-serif; 
            margin: 0; padding: 5px; display: flex; flex-direction: column; 
            height: 100vh; width: 100vw; overflow: hidden;
        }
        
        /* ミッション：最上部 */
        .m-hdr { 
            background: #000; border: 1px solid var(--cain); padding: 4px; 
            border-radius: 4px; margin-bottom: 4px; text-align: center; flex-shrink: 0; 
        }
        #m-idx { font-size: 11px; font-weight: bold; color: var(--cain); display: block; }
        .m-st { font-size: 10px; color: #fff; }
        .achieved { background: var(--cain) !important; color: #000 !important; }

        /* カイン：極薄の一行表示（オーエンは完全に削除） */
        .stat-line { 
            background: #111; padding: 4px 8px; border-radius: 4px; margin-bottom: 4px;
            display: flex; align-items: center; gap: 10px; flex-shrink: 0; border: 1px solid #333;
        }
        .c-lbl { font-size: 10px; font-weight: bold; color: var(--cain); }
        .bar-wrap { flex-grow: 1; display: flex; gap: 8px; }
        .bar-inner { flex-grow: 1; display: flex; align-items: center; gap: 4px; }
        .bg-b { background: #222; height: 5px; flex-grow: 1; border-radius: 2px; overflow: hidden; }
        #h-fill { background: var(--hp); height: 100%; transition: width 0.3s; }
        #m-fill { background: #3498db; height: 100%; transition: width 0.3s; }
        .num-t { font-size: 9px; font-family: monospace; min-width: 35px; }

        /* 情報：一行 */
        .i-bar { font-size: 10px; background: #000; padding: 3px; display: flex; justify-content: space-around; margin-bottom: 4px; flex-shrink: 0; border-bottom: 1px solid #222; }
        
        /* ログ：ここが最大の広さを持つ */
        #log { 
            background: #000; flex-grow: 1; overflow-y: auto; padding: 8px; 
            font-size: 12px; line-height: 1.4; margin-bottom: 4px;
        }
        .log-owen { color: var(--owen); font-weight: bold; }
        .log-dmg { color: #ff7675; } .log-sys { color: #888; font-size: 10px; }

        /* ボタン：最下部固定 */
        .btns { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; flex-shrink: 0; padding-bottom: 5px; }
        button { 
            background: #252e38; color: #fff; border: 1px solid #444; padding: 5px; 
            border-radius: 4px; font-size: 11px; font-weight: bold; min-height: 44px; cursor: pointer; 
        }
        #btn-boss { background: #633277; grid-column: span 2; display: none; border-color: var(--owen); }
        .sub { font-size: 8px; opacity: 0.7; display: block; font-weight: normal; }
    </style>
</head>
<body>

    <div class="m-hdr" id="m-box">
        <span id="m-idx">目的：古い銀貨を3枚持ち帰れ</span>
        <span class="m-st" id="m-det">0 / 3 (未達成)</span>
    </div>

    <div class="stat-line">
        <span class="c-lbl">CAIN</span>
        <div class="bar-wrap">
            <div class="bar-inner">
                <span class="num-t">HP</span>
                <div class="bg-b"><div id="h-fill" style="width: 100%;"></div></div>
            </div>
            <div class="bar-inner">
                <span class="num-t">MP</span>
                <div class="bg-b"><div id="m-fill" style="width: 100%;"></div></div>
            </div>
        </div>
    </div>

    <div class="i-bar">
        <span>倉庫:<b id="g-inv">0</b></span>
        <span>手荷物:<b id="t-inv">0</b></span>
        <span>甘味:<b id="sw">3</b></span>
        <span>残り:<b id="dist">10</b>km</span>
    </div>

    <div id="log"></div>

    <div class="btns">
        <button id="btn-boss" onclick="act('boss')">深部に潜む影を排除する</button>
        <button onclick="act('safe')">慎重に進む<span class="sub">1km進行 / 低リスク</span></button>
        <button onclick="act('bold')">大胆に進む<span class="sub">2km進行 / 高リスク</span></button>
        <button onclick="act('eat')">甘味消費<span class="sub">オーエンを宥める</span></button>
        <button onclick="act('inn')">宿屋に戻る<span class="sub">精算・回復</span></button>
    </div>

<script>
window.onload = function() {
    const ITEMS = { 'coin': '古い銀貨', 'pot': '蜂蜜酒' };
    const MISSIONS = [{ id: 0, target: 'coin', count: 3, label: '古い銀貨' }];

    let st = {
        o_m: 120, o_mm: 120,
        c_h: 120, c_mh: 120, c_m: 50, c_mm: 50,
        gInv: {}, tInv: [], sw: 3, mIdx: 0, dist: 10
    };

    function ui() {
        document.getElementById('h-fill').style.width = (st.c_h / st.c_mh * 100) + "%";
        document.getElementById('m-fill').style.width = (st.c_m / st.c_mm * 100) + "%";
        document.getElementById('dist').innerText = st.dist;
        document.getElementById('btn-boss').style.display = (st.dist === 0) ? "block" : "none";

        const m = MISSIONS[st.mIdx] || {label:"完了", target:"", count:0};
        const total = (st.gInv[m.target] || 0) + st.tInv.filter(id => id === m.target).length;
        const ready = (m.target !== "" && total >= m.count);
        
        document.getElementById('m-idx').innerText = m.target ? `目的：${m.label}を${m.count}個` : "全依頼完了";
        document.getElementById('m-det').innerText = `${total} / ${m.count} (${ready ? '達成：宿屋へ' : '未達成'})`;
        document.getElementById('m-box').className = ready ? "m-hdr achieved" : "m-hdr";

        document.getElementById('sw').innerText = st.sw;
        document.getElementById('t-inv').innerText = st.tInv.length;
        document.getElementById('g-inv').innerText = Object.values(st.gInv).reduce((a,b)=>a+b,0);
    }

    window.act = function(type) {
        if(st.c_h <= 0 && type !== 'inn') return;
        const log = document.getElementById('log');
        const add = (txt, cls="") => {
            const d = document.createElement('div'); if(cls) d.className = cls;
            d.innerHTML = txt; log.appendChild(d); log.scrollTop = log.scrollHeight;
        };

        if(type === 'safe' || type === 'bold') {
            const isB = type === 'bold';
            st.dist = Math.max(0, st.dist - (isB ? 2 : 1));
            st.o_m -= (isB ? 20 : 8);
            add(isB ? "オーエンが最短距離を突き進んだ。" : "カインが周囲を警戒し道を作った。");

            if(Math.random() < 0.2) add("<span class='log-owen'>【オーエン】</span>「……目障りだ」 紫の炎が敵を焼き払う。", "log-owen");

            if(Math.random() < (isB ? 0.5 : 0.2)) {
                st.c_h -= isB ? 30 : 15;
                add("敵の強襲。カインが盾となり衝撃を殺した。", "log-dmg");
                if(st.c_h <= 0) {
                    add("【全滅】カインが倒れ、全てを失って這い戻った。", "log-dmg");
                    st.tInv = []; st.dist = 10; st.c_h = 10;
                } else {
                    st.tInv.push('coin');
                    add("[古い銀貨]を回収。", "log-sys");
                }
            }
        } else if(type === 'boss') {
            add("<span class='log-owen'>【オーエン】</span>「消え失せろ」 深部の闇が霧散した。", "log-owen");
            st.dist = 10;
        } else if(type === 'eat') {
            if(st.sw > 0) { st.sw--; st.o_m = st.o_mm; add("オーエンは菓子を頬張り、機嫌を戻した。"); }
        } else if(type === 'inn') {
            st.tInv.forEach(id => { st.gInv[id] = (st.gInv[id]||0)+1; });
            st.tInv = []; st.c_h=st.c_mh; st.c_m=st.c_mm; st.o_m=st.o_mm; st.sw=3; st.dist=10;
            add("宿屋に帰還。カインは黙々と装備を磨いた。");
        }
        ui();
    };
    ui();
    add("主人の依頼：『古い銀貨を3枚、持ってきてくれ』", "log-sys");
};
</script>
</body>
</html>