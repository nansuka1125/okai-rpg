<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Resonance RPG -Final Stable-</title>
    <style>
        :root { --bg: #0d0d0f; --card: #1a1a22; --owen: #9b59b6; --cain: #f1c40f; --hp: #e74c3c; --text: #dcdde1; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; padding: 10px; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        .mission { border: 1px solid var(--hp); color: #ff7675; text-align: center; padding: 8px; margin-bottom: 8px; font-weight: bold; font-size: 14px; flex-shrink: 0; }
        
        .char-card { background: var(--card); padding: 8px; border-radius: 4px; margin-bottom: 6px; border-left: 4px solid #444; flex-shrink: 0; }
        .st-line { display: flex; justify-content: space-between; font-size: 13px; font-weight: bold; }
        
        .res-bar { font-size: 11px; background: #222; padding: 6px; display: flex; justify-content: space-around; margin-bottom: 8px; border-radius: 4px; flex-shrink: 0; }
        
        #log { background: #000; flex-grow: 1; overflow-y: auto; padding: 10px; font-size: 13px; line-height: 1.5; border: 1px solid #333; margin-bottom: 10px; border-radius: 4px; }
        
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; flex-shrink: 0; padding-bottom: 10px; }
        button { 
            background: #34495e; color: #fff; border: 1px solid #555; padding: 10px 5px; border-radius: 6px; 
            font-size: 13px; font-weight: bold; min-height: 50px; cursor: pointer;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        button:active { background: #2c3e50; transform: translateY(2px); }
        .sub-t { font-size: 10px; opacity: 0.8; font-weight: normal; }
        
        .ev { color: #55efc4; } .dmg { color: #ff7675; font-weight: bold; } .sys { color: #888; font-size: 11px; }
    </style>
</head>
<body>

<div class="mission" id="m-info">目的地まで: 10km</div>

<div class="char-card" style="border-color: var(--owen);">
    <div style="color:var(--owen);">オーエン</div>
    <div class="st-line"><span>HP: <span id="o-h">80</span></span> <span>MP: <span id="o-m">120</span></span></div>
</div>

<div class="char-card" style="border-color: var(--cain);">
    <div style="color:var(--cain);">カイン</div>
    <div class="st-line"><span>HP: <span id="c-h">120</span></span> <span>MP: <span id="c-m">50</span></span></div>
</div>

<div class="res-bar">
    <span>備蓄: <b id="t-mat">0</b></span> <span>戦利品: <b id="inv-c">0</b>個</span> <span>甘味: <b id="sw">3</b></span>
</div>

<div id="log"></div>

<div class="controls">
    <button onclick="cmd('safe')">慎重に進む<span class="sub-t">距離-1/素材小</span></button>
    <button onclick="cmd('bold')">大胆に進む<span class="sub-t">距離-2/素材大</span></button>
    <button onclick="cmd('eat')">甘味消費<span class="sub-t">オーエンMP回復</span></button>
    <button onclick="cmd('inn')">宿屋に戻る<span class="sub-t">精算・全回復</span></button>
</div>

<script>
    const st = { o:{h:80,mh:80,m:120,mm:120}, c:{h:120,mh:120,m:50,mm:50}, t:0, inv:[], sw:3, dist:10, boss:false };
    const items = ["トカゲの尻尾", "銀の指輪", "魔力の欠片", "古びたコイン", "光る苔", "不気味な瞳"];
    
    function addLog(m, cl="") {
        const l = document.getElementById('log');
        const d = document.createElement('div');
        if(cl) d.className = cl;
        d.innerHTML = m;
        l.appendChild(d);
        l.scrollTop = l.scrollHeight;
    }

    function update() {
        document.getElementById('o-h').innerText = st.o.h;
        document.getElementById('o-m').innerText = st.o.m;
        document.getElementById('c-h').innerText = st.c.h;
        document.getElementById('c-m').innerText = st.c.m;
        document.getElementById('t-mat').innerText = st.t;
        document.getElementById('inv-c').innerText = st.inv.length;
        document.getElementById('sw').innerText = st.sw;
        document.getElementById('m-info').innerText = st.boss ? "⚠ 厄災の核 と交戦中" : `目的地まで: ${st.dist}km`;
    }

    function cmd(type) {
        if(st.c.h <= 0 && type !== 'inn') return;

        if(type === 'safe' || type === 'bold') {
            const isB = (type === 'bold');
            st.dist = Math.max(0, st.dist - (isB ? 2 : 1));
            st.o.m = Math.max(0, st.o.m - (isB ? 20 : 8));
            addLog(isB ? "オーエンが最短距離を突き進む。" : "カインが慎重に道を切り拓く。");

            // 突発イベント (30%)
            if(Math.random() < 0.3) {
                const r = Math.random();
                if(r < 0.3) {
                    st.c.h -= 15; addLog("【イベント】カインが民衆に囲まれ、もみくちゃにされた。", "ev");
                } else if(r < 0.6) {
                    st.o.m -= 20; addLog("【イベント】オーエンが退屈に耐えかね、無意味な爆破魔法を放った。", "ev");
                }