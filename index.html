<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ç¥ç€ã®æ£®ã®æ¢ç´¢</title>
    <style>
        /* --- CSS: åŸºæœ¬è¨­å®šãƒ»iPhone Safariå¯¾ç­– --- */
        :root {
            --bg-color: #1a1a1a;
            --text-main: #ffffff;
            --text-info: #aaaaaa;
            --text-owen: #d196ff;
            --text-alert: #ff5555;
            --ui-bg: #333333;
            --accent: #4a90e2;
            --safe-area-bottom: 20px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Hiragino Kaku Gothic ProN", sans-serif;
            background-color: #000;
            color: var(--text-main);
            width: 100%;
            height: 100vh; /* ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ */
            height: 100dvh;
            overflow: hidden; /* å…¨ä½“ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç¦æ­¢ */
            display: flex;
            flex-direction: column;
        }

        /* --- Header: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ --- */
        header {
            padding: 10px 15px;
            padding-top: calc(10px + env(safe-area-inset-top));
            background: var(--ui-bg);
            border-bottom: 1px solid #444;
            flex-shrink: 0;
        }

        .status-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hp-container {
            width: 60%;
            height: 12px;
            background: #555;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        #hp-bar {
            width: 100%;
            height: 100%;
            background: var(--text-alert);
            transition: width 0.3s ease;
        }

        /* --- Main: ãƒ­ã‚°ã‚¨ãƒªã‚¢ --- */
        main {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            background-color: #000;
            -webkit-overflow-scrolling: touch;
        }

        .log-entry { font-size: 14px; line-height: 1.6; animation: fadeIn 0.2s ease; }
        .system { color: var(--text-main); }
        .info { color: var(--text-info); }
        .owen { color: var(--text-owen); font-weight: bold; }
        .alert { color: var(--text-alert); font-weight: bold; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- UI Overlay: ã‚¢ã‚¤ãƒ†ãƒ ç”»é¢ --- */
        #item-screen {
            display: none;
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 100;
            padding: 40px 20px;
        }

        /* --- Sub-Menu: ç¬¬4ã®ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ --- */
        #sub-menu {
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0,0,0,0.5);
            flex-shrink: 0;
        }

        /* --- Footer: æ“ä½œç³» --- */
        footer {
            background: var(--ui-bg);
            padding: 15px 15px calc(var(--safe-area-bottom) + env(safe-area-inset-bottom));
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            flex-shrink: 0;
            border-top: 1px solid #444;
        }

        button {
            padding: 12px 5px;
            border: none;
            border-radius: 8px;
            background: #555;
            color: #fff;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
        }

        button:active { opacity: 0.7; transform: scale(0.98); }
        button:disabled { opacity: 0.3; cursor: not-allowed; }
        .btn-main { background: var(--accent); }
        .btn-context { background: #e67e22; width: 80%; }
    </style>
</head>
<body>

<header>
    <div class="status-row">
        <span>ğŸ“ <span id="loc-name">å®¿å±‹</span> (<span id="dist-val">0</span>km)</span>
        <div class="hp-container"><div id="hp-bar"></div></div>
        <span>HP: <span id="hp-val">10</span></span>
    </div>
</header>

<main id="game-log">
    </main>

<div id="item-screen">
    <h2>ğŸ’ æ‰€æŒå“</h2>
    <div id="item-list" style="margin-top:20px;"></div>
    <button onclick="toggleItems()" style="margin-top:20px; width:100%;">é–‰ã˜ã‚‹</button>
</div>

<section id="sub-menu">
    </section>

<footer>
    <button id="btn-back" onclick="move(-1)">â¬…ï¸ æˆ»ã‚‹</button>
    <button id="btn-forward" class="btn-main" onclick="move(1)">â¡ï¸ é€²ã‚€</button>
    <button id="btn-item" onclick="toggleItems()">ğŸ’ é“å…·</button>
</footer>

<script>
// --- CONFIG: å®šæ•°ç®¡ç† ---
const CONFIG = {
    INITIAL_HP: 10,
    INITIAL_MOOD: 50,
    SAFE_HP: 1,
    LOCATIONS: { 0: "å®¿å±‹", 5: "ç¥ç€ã®æ£®å…¥å£", 10: "æ·±ç·‘ã®å°é“" }
};

// --- STATE: ã‚²ãƒ¼ãƒ çŠ¶æ…‹ ---
let state = {
    hp: CONFIG.INITIAL_HP,
    mood: CONFIG.INITIAL_MOOD,
    distance: 0,
    items: [{ id: 'herb', name: 'è–¬è‰', count: 2 }],
    isGameOver: false
};

// --- UI: è¡¨ç¤ºæ›´æ–°ç³» ---
function updateUI() {
    document.getElementById('hp-val').textContent = state.hp;
    document.getElementById('dist-val').textContent = state.distance;
    document.getElementById('hp-bar').style.width = (state.hp / CONFIG.INITIAL_HP * 100) + "%";
    document.getElementById('loc-name').textContent = CONFIG.LOCATIONS[state.distance] || "ç¥ç€ã®æ£®";

    const btnForward = document.getElementById('btn-forward');
    const btnBack = document.getElementById('btn-back');

    if (state.hp <= CONFIG.SAFE_HP) {
        btnForward.disabled = true;
        btnBack.disabled = true;
        showContextButton("ğŸ›Œ å®¿å±‹ã¸æˆ»ã‚‹", resetGame);
    } else {
        btnForward.disabled = false;
        btnBack.disabled = state.distance <= 0;
        updateContextArea();
    }
}

// --- LOG: ãƒ­ã‚°å‡ºåŠ›ç³» ---
function addLog(text, type = 'system') {
    const logArea = document.getElementById('game-log');
    const entry = document.createElement('div');
    entry.className = `log-entry ${type}`;
    
    if (type === 'owen') {
        entry.textContent = `ã‚ªãƒ¼ã‚¨ãƒ³ã€Œ${text}ã€`;
    } else {
        entry.textContent = text;
    }
    
    logArea.appendChild(entry);
    logArea.scrollTop = logArea.scrollHeight;
}

// --- LOGIC: ç§»å‹•å‡¦ç† ---
function move(dir) {
    if (state.hp <= CONFIG.SAFE_HP) return;

    state.distance += dir;
    if (state.distance < 0) state.distance = 0;

    addLog(`${dir > 0 ? '1kmé€²ã‚“ã ã€‚' : '1kmæˆ»ã£ãŸã€‚'}`, 'system');
    
    // ç¢ºç‡ã§ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
    if (Math.random() > 0.7) {
        let dmg = 2;
        state.hp = Math.max(CONFIG.SAFE_HP, state.hp - dmg);
        addLog(`é­”ç‰©ã«è¥²ã‚ã‚ŒãŸï¼ ${dmg}ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`, 'alert');
        if (state.hp === CONFIG.SAFE_HP) {
            addLog("ã‚‚ã†å‹•ã‘ãªã„â€¦å®¿å±‹ã«æˆ»ã‚ã†ã€‚", 'owen');
        }
    } else if (Math.random() > 0.8) {
        addLog("é™ã‹ãªæ£®ã®ç©ºæ°—ãŒæ¼‚ã£ã¦ã„ã‚‹ã€‚", 'info');
    }

    updateUI();
}

// --- UI: ç¬¬4ã®ãƒœã‚¿ãƒ³åˆ¶å¾¡ ---
function showContextButton(text, action) {
    const container = document.getElementById('sub-menu');
    container.innerHTML = '';
    const btn = document.createElement('button');
    btn.className = 'btn-context';
    btn.textContent = text;
    btn.onclick = action;
    container.appendChild(btn);
}

function updateContextArea() {
    const container = document.getElementById('sub-menu');
    container.innerHTML = '';
    
    if (state.distance === 0 && state.hp < CONFIG.INITIAL_HP) {
        showContextButton("ğŸ’¤ ä¼‘ã‚€", resetGame);
    } else if (state.distance === 5) {
        showContextButton("ğŸ’¬ ã‚ªãƒ¼ã‚¨ãƒ³ã¨è©±ã™", () => addLog("ã“ã“ãŒç¥ç€ã®æ£®ã®å…¥ã‚Šå£ã ã­ã€‚", "owen"));
    }
}

// --- LOGIC: ã‚¢ã‚¤ãƒ†ãƒ ç®¡ç† ---
function toggleItems() {
    const screen = document.getElementById('item-screen');
    const list = document.getElementById('item-list');
    
    if (screen.style.display === 'block') {
        screen.style.display = 'none';
    } else {
        screen.style.display = 'block';
        list.innerHTML = '';
        state.items.forEach(item => {
            const div = document.createElement('div');
            div.style.padding = "15px";
            div.style.borderBottom = "1px solid #444";
            div.textContent = `${item.name} x${item.count}`;
            div.onclick = () => useItem(item.id);
            list.appendChild(div);
        });
    }
}

function useItem(id) {
    const item = state.items.find(i => i.id === id);
    if (item && item.count > 0) {
        if (id === 'herb') {
            state.hp = Math.min(CONFIG.INITIAL_HP, state.hp + 5);
            item.count--;
            addLog(`${item.name}ã‚’ä½¿ç”¨ã—ãŸã€‚HPãŒå›å¾©ã—ãŸã€‚`, 'system');
        }
        toggleItems();
        updateUI();
    }
}

// --- LOGIC: ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆï¼ˆå®¿å±‹ï¼‰ ---
function resetGame() {
    state.hp = CONFIG.INITIAL_HP;
    state.distance = 0;
    addLog("å®¿å±‹ã§ã‚†ã£ãã‚Šä¼‘ã‚“ã ã€‚HPãŒå…¨å›å¾©ã—ãŸã€‚", "system");
    updateUI();
}

// --- INIT: åˆæœŸåŒ– ---
window.onload = () => {
    addLog("ã‚«ã‚¤ãƒ³ã¨ã‚ªãƒ¼ã‚¨ãƒ³ã®æ—…ãŒå§‹ã¾ã‚‹ã€‚", "info");
    updateUI();
};
</script>

</body>
</html>
