<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resonance RPG -Stable Edition-</title>
    <style>
        :root { --bg: #0d0d0f; --card: #1a1a22; --owen: #9b59b6; --cain: #f1c40f; --hp: #e74c3c; --mp: #3498db; --text: #dcdde1; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; padding: 10px; font-size: 14px; }
        .mission { border: 1px solid var(--hp); color: #ff7675; text-align: center; padding: 10px; margin-bottom: 10px; font-weight: bold; }
        .char-card { background: var(--card); padding: 10px; border-radius: 5px; margin-bottom: 8px; border-left: 4px solid #444; }
        .st-line { display: flex; justify-content: space-between; margin: 3px 0; font-size: 0.85rem; }
        #log { background: #000; height: 220px; overflow-y: auto; padding: 10px; font-size: 0.8rem; line-height: 1.6; border: 1px solid #333; margin-bottom: 10px; }
        .res-bar { font-size: 0.75rem; background: #222; padding: 8px; display: flex; justify-content: space-between; margin-bottom: 10px; border-radius: 4px; }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        button { background: #2d3436; color: #fff; border: 1px solid #555; padding: 12px 5px; border-radius: 5px; cursor: pointer; font-size: 0.8rem; height: 55px; }
        button:disabled { opacity: 0.2; }
        .sys { color: #888; font-style: italic; font-size: 0.75rem; }
        .ev { color: #55efc4; }
        .dmg { color: #ff7675; font-weight: bold; }
    </style>
</head>
<body>

<div class="mission" id="m-info">目的地まで: 10km</div>

<div class="char-card" style="border-color: var(--owen);">
    <div style="color:var(--owen); font-weight:bold;">オーエン</div>
    <div class="st-line"><span>HP: <b id="o-h">80</b>/80</span> <span>MP: <b id="o-m">120</b>/120</span></div>
</div>

<div class="char-card" style="border-color: var(--cain);">
    <div style="color:var(--cain); font-weight:bold;">カイン</div>
    <div class="st-line"><span>HP: <b id="c-h">120</b>/120</span> <span>MP: <b id="c-m">50</b>/50</span></div>
</div>

<div class="res-bar">
    <span>備蓄: <b id="t-mat">0</b></span>
    <span>戦利品: <b id="inv-c">0</b>個</span>
    <span>甘味: <b id="sw">3</b></span>
</div>

<div id="log"></div>

<div class="controls">
    <button onclick="cmd('safe')">慎重に進む<br>(素材・小)</button>
    <button onclick="cmd('bold')">大胆に進む<br>(素材・大)</button>
    <button onclick="cmd('eat')">甘味消費<br>(オーエン回復)</button>
    <button onclick="cmd('inn')">宿屋に戻る<br>(精算/全快)</button>
</div>

<script>
    const st = { o:{h:80,mh:80,m:120,mm:120}, c:{h:120,mh:120,m:50,mm:50}, t:0, inv:[], sw:3, dist:10, boss:false };
    const items = ["トカゲの尻尾", "銀の指輪", "魔力の欠片", "古びたコイン", "光る苔", "不気味な瞳"];
    
    function addLog(m, cl="") {
        const l = document.getElementById('log');
        l.innerHTML += `<div class="${cl}">${m}</div>`;
        l.scrollTop = l.scrollHeight;
    }

    function update() {
        document.getElementById('o-h').innerText = st.o.h;
        document.getElementById('o-m').innerText = st.o.m;
        document.getElementById('c-h').innerText = st.c.h;
        document.getElementById('c-m').innerText = st.c.m;
        document.getElementById('t-mat').innerText = st.t;
        document.getElementById('inv-c').innerText = st.inv.length;
        document.getElementById('sw').innerText = st.sw;
        document.getElementById('m-info').innerText = st.boss ? "⚠ 厄災の核 と交戦中" : `目的地まで: ${st.dist}km`;
    }

    function cmd(type) {
        if(st.c.h <= 0 && type !== 'inn') return;

        if(type === 'safe' || type === 'bold') {
            const isB = (type === 'bold');
            st.dist = Math.max(0, st.dist - (isB ? 2 : 1));
            st.o.m = Math.max(0, st.o.m - (isB ? 20 : 8));
            addLog(isB ? "オーエンが最短距離を突き進む。" : "カインが慎重に道を切り拓く。");

            // 突発イベント (30%)
            if(Math.random() < 0.3) {
                const r = Math.random();
                if(r < 0.3) {
                    st.c.h -= 10; addLog("【イベント】カインがモテすぎて疲弊した。", "ev");
                } else if(r < 0.6) {
                    st.o.m -= 15; addLog("【イベント】